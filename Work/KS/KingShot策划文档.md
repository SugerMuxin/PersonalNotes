---
author: RuoSaChen
tags:
  - work
---


KingShot

// 策划对接

1. Building 表里添加一些字段
		model : 填写该建筑需要使用的模型，如果不同等级需要使用不同的模型
			"model": "castle40000"
		    "model": "castle40000,1;castle40000_1,10;castle40000_2,20"
		pos: 1        (int )      对应场景中放在哪个建筑位置，场景中会为每个建筑分配一个建筑点
	    scale: 1.0   ( float )  类似于建筑所占的格子数，用于控制残骸的大小
	    area: 1     （int）    建筑对应的内城的地块归属 ( 内城会根据城墙的范围划分为几个大块)
	    batch: 1  （int）     建筑对应的内城解锁批次 	 
		 
		 
2. 整理模型和场景，要注意一下面片数.（另外需要一个破损的建筑，如果后面可能做室内效果的话，屋顶要单独分层）
		 命名为 castle40000 ,farm41500 这种
		 预制体目录: Assets\AssetBundles\DayZ\PlatformDefault\Default\Game\City3D\Prefabs
		 生资源目录: Assets\Game\KingShot\City3D (这个目录放和内城展示相关资源)

3.  安排好 CityScene3D 下 CityRoots 下每个建筑位置，和每个建筑应该在建造的位置一一对应
   
4. 使用一个全建筑的老账号，记录下每个建筑的位置 ( 28,28) 这种，包括有些固定位置的建筑，服务器可能有验证，必须在指定位置，用于在3D内城建造时期给服务器的协议数据使用，默认服务器都建造在指定位置。  （这个数据可以存储在预制体上也可以存储在配置表中）

5. 建筑预制体的结构参考
	（1）大体结构 （参考House-2）![[Pasted image 20250707112838.png]]
	（2）每个建筑需要添加一个以下组件，大小请根据建筑调整。（内城战斗的寻路）
	![[Pasted image 20250707113017.png]] 
	（3）每个建筑需要根据情况添加至少一个Colider 用于点击事件拦截，具体几个根据场景的阻挡关系复杂程度（寻路需求）而定。
	（4）建筑的使用的材质和网格的数量都应该尽量少（减少drawcall次数） ，如果后面批次过高，后面的内城部分建筑可以考虑和背景场景合在一块静态的方案
	（5）最终关于建筑的场景搭建的顶点数约要控制在20W以内，因为后面还需要预留一部分给必须动态绘制的战斗部分

6. 任务中去除此版本中不能完成的任务，比如解锁2号地块、 拾取拾荒点等。     
	 tip: 6020004 这个任务，建造周笔畅。    "gotype": 2,     "go": 434000,。 gotype只有帝国改为408 （6.6.0  165修改）

7. 场景中使用到的静态的 .FBX 参考以下设置，以减少内存的消耗。
	A：使用Medium 使用 High也行
	B：Flase
	C：Everything
	D：16
	E：True
	![[Pasted image 20250710142809.png]]

8. 需要根据内城区域的划分给几张mask的遮罩贴图，边缘模糊平滑过渡！用于迷雾的遮罩剔除。

9. 整理项目中的测试资源
		Assets/Lowpoly Style  目录下的全部为测试资源

------------------------------------------------------------------------------------

老账号可能面临的问题
>1. 引导的中继，功能的开启绑定的引导。
>2. 任务的修改，这一部分应该较少，限时任务的处理

-------------------------------------------------
工作安排
	1. 下周：    新账号的游戏流程能够跑通，这个过程涉及到建筑的依赖解锁关系，和任务的流程串通
	2. 下下周：地块分割与迷雾处理。 游戏资源的载入，批次和性能控制，

//程序部分
1. 资源建筑上的粒子效果
	FunBuild3D_Resource addDurableDamageParticle
2. 解决逻辑上区域分配问题，可能通过添加阻挡的方式
3. 跳转逻辑兼容性修改
4. 自由建造相关功能兼容性屏蔽,
5. 引导兼容性修改（和地图交互的引导和带入引导需要重做，触发引导的修改）
6. 升级建筑时的建筑的工人，需要添加新的AI逻辑，使用navmesh寻路


//我的待定问题
0. 所有标记了 TODO 的部分
1.  FunBuild3D_Market  中热气球的处理 ShowHelicopter
2.  区域解锁相关处理，迷雾的处理
3. 类实时阴影的处理

性能问题方面
1. 关闭项目中的各向异性贴图采样，减少渲染消耗（各向异性适合于和相机平面的角度过大的时候使用，我们的场景中的物体大部分于相机平面夹角不会太大）
2. 屏蔽掉场景中对当前渲染毫无贡献的相机，CPU依然会进行没必要的数据准备



----------------------
##### <span style="color:yellow;">表的修改记录</span>

客户端：
1. FunctionControl  表中所有的开启条件修需要重新修改
2. Building 
3. BuildingPosUnlock （新添加）

服务器：
	1.每个建筑都建造在固定的建筑
	2.onlyPlace 建筑的这个字段修改为锚定的 




------------------------------------------------------------------------------------





内城优化
	
	1.树要合并Mesh，最好能够在场景布局好之后合并成一个大Mesh。动态合批
	2人物也要合并网格
	